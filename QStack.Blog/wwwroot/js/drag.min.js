(function(n){function o(){var c=e,v,o;u===""&&(u="300*300");v=u.split("*");t=v[0];i=v[1];n("#"+r).css("width",t);n("#"+r).css("height",parseInt(i)+34);h();n("#drag").drag(f,t,i,r);var k=c.y,d=c.small,g=c.array,nt=c.normal;t=c.imgX;i=c.imgY;n(".cut_bg").css("background-image","url("+nt+")");n("#xy_img").css("background-image","url("+d+")");n("#xy_img").css("top",k);n("#drag").css("width",t);n("#drag .drag_text").css("width",t);n(".cut_bg").css("width",t/10);n(".cut_bg").css("height",i/2);n(".refesh_bg").show();n(".refesh_bg").css("left",t-25);var b=g.split(","),y=t/10,p=i/2;for(o=0;o<b.length;o++){var w=s(b,o.toString()),a=0,l=0;l=o>9?-p:0;a=o>9?(o-10)*-y:o*-y;w>9&&o<10&&(l=l-p);o>9&&w<10&&(l=l+p);a=a+(w-o)*-y;n("#bb"+o).css("background-position",a+"px "+l+"px")}n(".vcode-hints").remove()}function s(n,t){var r,i;if(n&&n.indexOf)return n.indexOf(t);for(r=n.length,i=0;i<r;i++)if(n[i]===t)return i;return-1}function h(){var f=document.getElementById(r),n,u;for(f.innerHTML="",n="<div style='width:"+t+"px;height:"+i+"px;background-color:#e8e8e8;'>",n+="<div class='vcode-hints'style='width:"+t+"px;line-height:"+i/100*7+";'>正在载入...<\/div>",u=0;u<20;u++)n+="<div id='bb"+u+"'class='cut_bg'><\/div>";n+="<div id='xy_img'class='xy_img_bord'><\/div><\/div><div id='drag'><\/div>";f.innerHTML=n}var t=0,i=0,u="",f,r,e={};n.fn.slide=function(n){var t,i;if(e=n.captchaInfo,t=n.imgspec,f=n.successCallBack,typeof t=="undefined"?t="300*300":typeof t!="string"&&(t="300*300"),i=this,r=i.attr("id"),u=t,r===undefined)throw i.selector+" does not exist";o()};n.fn.refresh=o})(jQuery),function(n){n.fn.drag=function(t,i,r,u){function p(n){e.show();h=!0;o=n-parseInt(f.css("left"),10);a=new Date}function w(t){var i=t-o;h&&(i>0&&i<=l?(e.css({left:i}),n(".refesh_bg").hide(),f.css({left:i}),c.css({width:i}),y.push([i,(new Date).getTime()])):i>l)}function b(i){if(h&&(h=!1,!isNaN(o)&&o!==undefined)){var r=Math.round(i-o);if(r<10){n(".refesh_bg").show();e.css({left:0});f.css({left:0});c.css({width:0});return}v=new Date;n.ajax({type:"POST",url:"/captcha/check",dataType:"JSON","async":!0,data:{point:r,timespan:v-a,datelist:y.join("|")},success:function(i){if(i.code===200){for(var o=1;4>=o;o++)e.animate({left:r-(40-10*o)},50),e.animate({left:r+2*(40-10*o)},50,function(){e.css({left:i.data})});f.css({left:l});c.css({width:l});e.removeClass("xy_img_bord");e.css("border","1px solid rgb(255,255,255)");n("#drag a").remove();t!==undefined&&t();g()}else n(".refesh_bg").show(300),e.animate({left:0},300),f.animate({left:0},300),c.animate({width:0},300),i.msg>4&&n("#"+u).refresh()},beforeSend:function(){}})}}function k(n){n.preventDefault()}function g(){f.removeClass("handler_bg").addClass("handler_ok_bg");d.text("验证通过");s.css({color:"#fff"});f.unbind("mousedown");n(document).unbind("mousemove");n(document).unbind("mouseup");n(".refesh_bg").hide()}var o,s=this,h=!1;this.append('<div class="drag_bg"><\/div><div class="drag_text" onselectstart="return false;"unselectable="on">拖动图片验证<\/div><div class="handler handler_bg"><\/div><a href="javascript:;" title="点击刷新验证码"style="width:16px;height:16px;"><div class="refesh_bg"><\/div><\/a>');n(this.selector+" a").click(function(){console.log("%cVerificationCode Refresh","color:blue");n("#"+u).refresh()});n("#drag .drag_text").css("width",i);n(".refesh_bg").css("left",i-25);var f=s.find(".handler"),c=s.find(".drag_bg"),d=s.find(".drag_text"),l=i-36,a=new Date,v=new Date,e=n("#xy_img"),y=[];f.mousedown(function(n){p(n.pageX)});n(document).mousemove(function(n){w(n.pageX)});n(document).mouseup(function(n){b(n.pageX)});f.mouseout(function(){});f.on("touchstart",function(n){p(n.originalEvent.touches[0].pageX);document.addEventListener("touchmove",k,!1)});n(document).on("touchmove",function(n){w(n.originalEvent.touches[0].pageX)});n(document).on("touchend",function(n){b(n.originalEvent.changedTouches[0].pageX);document.removeEventListener("touchmove",k,!1)})}}(jQuery);